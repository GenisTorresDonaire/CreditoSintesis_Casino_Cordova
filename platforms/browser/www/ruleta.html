<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:; script-src * 'unsafe-eval' 'unsafe-inline'; connect-src * 'unsafe-eval' 'unsafe-inline';"">
        
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

        <link rel="stylesheet" type="text/css" href="css/index.css">
        <link rel="stylesheet" type="text/css" href="css/style_login.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <script type="text/javascript" src="js/bootstrap.min.js"></script>       
        <title>Casino World</title>
    </head>
    <body>
        <div class="app" style="visibility: hidden;">
            <h1>Apache Cordova</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>
        </div>

        <div class="container" style="height: 100%; width: 100%;">
            <!--    AJUSTES    -->
            <div id="creditos" style="border-radius: 10px; background: rgba(255,255,255,0.5); float: left; margin-top: 30px; min-width: 150px; text-align: center;">
                <span style="font-size: 40px; padding-right: 10px; padding-left: 10px;"><label id="creditosUsuario" >0</label><label>$</label></span>
            </div>

            <!--    AJUSTES    -->
            <div id="ir_ajustes" style="border-radius: 10px; background: rgba(0,0,255,0.5); float: right; margin-top: 30px; padding: 5px 5px 5px 5px;">
                <img src="img/ajustes.png" style="width: 50px; height: 50px;">
            </div>

            <!--    CABECERA TITULO    -->
            <div class="row" style="padding-top: 50px; padding-bottom: 50px;">
                <div class="col-md-12" style="text-align: center;"><h1>Casino World</h1></div>
            </div>

            <!--    MENU    -->
            <div class="row" style="background-color: white;">
                <canvas id='canvas' style="float: left; margin-left: 10px;"  height="500" width="400"></canvas>
                <div id='tablero' style="height:500px; width: 730px; float: right;">

                    <div class="numerosAnteriores" >
                        <table class="tablaNuemerosAnteriores" style="padding-left: 100px;">
                            <tr id="insertarTDsNumero">
                                <!-- Zona donde se insertaran los numeros -->
                            </tr>
                        </table>
                    </div>

                    <div class="reloj">
                        <label id="labelTiempo">00:00</label>
                    </div>

                    <table id="tableroRuleta">
                      <tr>
                        <td id="0" class="verde" rowspan="3">0</td>
                        <td id="3" class="rojo">3</td>
                        <td id="6" class="negro">6</td>
                        <td id="9" class="rojo">9</td>
                        <td id="12" class="rojo">12</td>
                        <td id="15" class="negro">15</td>
                        <td id="18" class="rojo">18</td>
                        <td id="21" class="rojo">21</td>
                        <td id="24" class="negro">24</td>
                        <td id="27" class="rojo">27</td>
                        <td id="30" class="rojo">30</td>
                        <td id="33" class="negro">33</td>
                        <td id="36" class="rojo">36</td>
                        <td id="fila3" class="azul">2-1</td>
                      </tr>
                      <tr>
                        <td id="2" class="negro">2</td>
                        <td id="5" class="rojo">5</td>
                        <td id="8" class="negro">8</td>
                        <td id="11" class="negro">11</td>
                        <td id="14" class="rojo">14</td>
                        <td id="17" class="negro">17</td>
                        <td id="20" class="negro">20</td>
                        <td id="23" class="rojo">23</td>
                        <td id="26" class="negro">26</td>
                        <td id="29" class="negro">29</td>
                        <td id="32" class="rojo">32</td>
                        <td id="35" class="negro">35</td>
                        <td id="fila2" class="azul">2-1</td>
                      </tr>
                      <tr>
                        <td id="1" class="rojo">1</td>
                        <td id="4" class="negro">4</td>
                        <td id="7" class="rojo">7</td>
                        <td id="10" class="negro">10</td>
                        <td id="13" class="negro">13</td>
                        <td id="16" class="rojo">16</td>
                        <td id="19" class="rojo">19</td>
                        <td id="22" class="negro">22</td>
                        <td id="25" class="rojo">25</td>
                        <td id="28" class="negro">28</td>
                        <td id="31" class="negro">31</td>
                        <td id="34" class="rojo">34</td>
                        <td id="fila1" class="azul">2-1</td>
                      </tr>
                      <tr>
                        <td></td>
                        <td id="1a12" class="azul" colspan="4">1a12</td>
                        <td id="2a12" class="azul" colspan="4">2a12</td>
                        <td id="3a12" class="azul" colspan="4">3a12</td>
                      </tr>
                      <tr>
                        <td></td>
                        <td id="1a18" class="azul" colspan="2">1a18</td>
                        <td id="par" class="azul" colspan="2">Par</td>
                        <td id="rojo" class="azul" colspan="2">Rojo</div></td>
                        <td id="negro" class="azul" colspan="2">Negro</td>
                        <td id="impar" class="azul" colspan="2">Impar</td>
                        <td id="19a36" class="azul" colspan="2">19a36</td>
                      </tr>
                    </table>

                    <div style="text-align: center;">
                        <input id="creditosApuesta" type="number" class="apuesta" value="100" oninput="this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');"/>
                    </div>
                    
                </div>

                </div>
                
                
            </div>
        </div>

        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/script.js"></script>  
        <script type="text/javascript" src="js/ruleta.js"></script>   


        <script>
            printarCreditos();
            printarNumeros();

            function printarCreditos(){
                $.ajax({
                    type : "GET",
                    url : "https://appcasino.herokuapp.com/api/creditos/"+localStorage.getItem('token'),     

                    success: function(respuesta){
                        respuesta = JSON.parse(respuesta);

                        if( respuesta[0].status == 'ok' ){
                            localStorage.setItem('creditos', respuesta[0].creditos);
                            $('#creditosUsuario').text(localStorage.getItem('creditos'));
                        }
                    },
                    error: function(respuesta){
                        console.log( "erroor creditos ----> " + JSON.stringify(respuesta) );
                    } 
                });
            }

            function printarNumeros(){
                

                //Funcion para printar los ultimos 10 numeros
                $.ajax({
                    type : "GET",
                    url : "https://appcasino.herokuapp.com/api/ultimos_diez_numeros/"+localStorage.getItem('id_partida'),     

                    success: function(respuesta){
                        respuesta = JSON.parse(respuesta);
                        
                        if( respuesta.status == 'ok' ){
                            var array = respuesta.mensaje;
                            // Separacion de la string por - para obtener los numeros y manipularlos uno a uno
                            var arrayDiezNum = array.split("-");
                            // Aqui se le da la vuelta al array para poder obtener los del final mas comodamente.
                            arrayDiezNum.reverse();

                            $('#insertarTDsNumero').empty();
                            // If para controlar si tiene menos de diez numeros
                            if ( arrayDiezNum.length < 10 ){
                                // For que obtiene todos los numeros una vez separados
                                for ( var cantidadNumeros = 0; cantidadNumeros < arrayDiezNum.length; cantidadNumeros++ ){
                                
                                    var color = $arrayNumerosRuletaColores[arrayDiezNum[cantidadNumeros]];
                                    // Ifs para cambiar el coger el nombre y hacer el cambio de espaÃ±ol a ingles.
                                    if ( color == 'rojo' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: red;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }else if ( color == 'verde' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: green;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }else if ( color == 'negro' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: black;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }   
                                }     
                            }
                            // si tiene mas de 10 numeros solo obtendremos los 10 ultimos
                            else{
                                // For que obtiene todos los numeros una vez separados
                                for( var cantidadNumeros = 0; cantidadNumeros < 10; cantidadNumeros++ ){
                                    var color = $arrayNumerosRuletaColores[arrayDiezNum[cantidadNumeros]];
                                    // Ifs para cambiar el coger el nombre y hacer el cambio de espaÃ±ol a ingles.
                                    if ( color == 'rojo' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: red;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }else if ( color == 'verde' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: green;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }else if ( color == 'negro' ){
                                        $('#insertarTDsNumero').prepend('<td style="color: white; background-color: black;">'+arrayDiezNum[cantidadNumeros]+'</td>');
                                    }
                                }
                            }
                        }          
                    },
                    error: function(respuesta){
                        console.log( "erroor ----> " + JSON.stringify(respuesta) );
                    } 
                }); 
            }


            setInterval(function(){
                printarCreditos();
                printarNumeros();
            }, 1000);


        </script>

    </body>
</html>
